---
title: "Network of variables at Pre"
output: html_notebook
---
Per Jonas's suggestion I will attempt to model no more than 8 variables simultaneously.

The seven variables Joanna and I chose in descending order of importance to keep in the model are:

HADS-A (drop first among anx measures?)
IES-R
FCR
Self Compassion
EAC
AAQc
CESD

# Read in the data and libraries

```{r}
library(tidyverse)
library(mgm)
library(qgraph)
library(psych)
library(skimr)  
library(corrr)

``` 

```{r}
data <- read_rds(file = here('4 Generated Datasets','Vars_At_Pre_Data.rds'))
presence <- read_rds(file = here('4 Generated Datasets','Vars_At_Pre_Presence.rds'))

```

# Examine univariates

Distributions look ok.

```{r}
data %>%  
  select(-ID, -Condition_Dummy, -Condition) %>%
  psych::describe()
  

``

# Examine bivariates

No correlations looking too high here which is good...

corrr package used for easy computation and display of the correlation matrix

```{r}

data %>%
  select(-ID, -Condition_Dummy, -Condition) %>%
  corrr::correlate() %>%
  corrr::rearrange() %>%
  corrr::shave() %>%
  corrr::fashion()
  
```

# Estimate network model

## Setup data object

Data must not contain any missing values (i.e. NAs)


```{r}

responses <- data %>% select(-ID, -Condition_Dummy, -Condition) %>%
  drop_na()

responses %>%
  psych::describe()

colnames(responses)

```

### Estimate model


```{r}

set.seed(08132021)
fit_mgm <- mgm::mgm(data = responses, 
         
         # tells model that all variables are continuous
         level = c(1,1,1,1,1,1,1), 
         
         # tells model that all variables have assumed Gaussian normal distribution
         type = c("g","g","g","g","g","g","g"), 
         
         k =2,
         
         # per Jonas set this way
         ruleReg = "OR")
         

```

## Plot model estimates
```{r}

width <- 9
pdf(here('5 Tables and Figures', 'Pre Network.pdf'), width = width, height = width*.6)

qgraph(fit_mgm$pairwise$wadj, 
       layout = 'spring', repulsion = 1.3,
       edge.color = fit_mgm$pairwise$edgecolor_cb, 
        legend.cex=.4, 
       vsize = 3.5, esize = 15, labels = c('HADS','IESR','FCR','SCS','EAC','AAQc','CESD'))

```
