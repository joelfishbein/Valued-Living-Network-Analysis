---
title: "Plot Network Models"
output:
  html_document:
    toc: true
    toc_float: true
---

# Read in data

```{r}
library(tidyverse)
library(here)
library(qgraph)

# Single timepoint models
Pre.fit <- read_rds(here('Fitted model objects','Pre.fit'))
Mid.fit <- read_rds(here('Fitted model objects','Mid.fit'))
Post.fit <- read_rds(here('Fitted model objects','Post.fit'))
my3mFU.fit <- read_rds(here('Fitted model objects','my3mFU.fit'))
my6mFU.fit <- read_rds(here('Fitted model objects','my6mFU.fit'))

PreToMid.fit <- read_rds(here('Fitted model objects','PreToMid.fit'))
MidToPost.fit <- read_rds(here('Fitted model objects','MidToPost.fit'))
PostTo3MFU.fit <- read_rds(here('Fitted model objects','PostTo3MFU.fit'))
my3mTo6mFU.fit <- read_rds(here('Fitted model objects','my3mTo6mFU.fit'))

PreToPost.fit <- read_rds(here('Fitted model objects','PreToPost.fit'))
PreTo6mFU.fit <- read_rds(here('Fitted model objects','PreTo6mFU.fit'))
```


## generic function to plot MGM
```{r}

plot_my_mgm <- function(my_mgm_fit){
  
  my_edgeweights <- my_mgm_fit$pairwise$wadj
  
  my_colorblind_edge_colors <- my_mgm_fit$pairwise$edgecolor_cb
  
  qgraph(my_edgeweights, 
         layout = 'spring', repulsion = 1.3,
         edge.color = my_colorblind_edge_colors, 
         legend.cex=.4, 
         vsize = 3.5, esize = 15, labels = c('*COND*','HADS','IESR','FCR','SCS','EAC','AAQc','CESD'))
}
  
```

# Create interval plots

## generate plot but don't save yet

```{r}

PreToMid.plot <- plot_my_mgm(PreToMid.fit)
MidToPost.plot <- plot_my_mgm(MidToPost.fit)
PostTo3MFU.plot <- plot_my_mgm(PostTo3MFU.fit)
my3mTo6mFU.plot <- plot_my_mgm(my3mTo6mFU.fit)

PreToPost.plot <- plot_my_mgm(PreToPost.fit)
PreTo6mFU.plot <- plot_my_mgm(PreTo6mFU.fit)

```

## Save layout of Pre to Post

```{r}

# save this layout so other plots can be done with this same layout
PreToPost.layout <-  PreToPost.plot$layout

```

## Output plots for each interval

```{r}
qgraph::qgraph(PreToMid.plot, title.cex = 2, title = "Pre To Mid", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','PreToMid'))

qgraph::qgraph(MidToPost.plot, title.cex = 2, title = "Mid To Post", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','MidToPost'))

qgraph::qgraph(PreToPost.plot, title.cex = 2, title = "Pre To Post", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','PreToPost'))

qgraph::qgraph(PostTo3MFU.plot, title.cex = 2, title = "Post To 3MFU", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','PostTo3MFU'))

qgraph::qgraph(my3mTo6mFU.plot, title.cex = 2, title = "3m To 6m FU", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','my3mTo6mFU'))

qgraph::qgraph(PreTo6mFU.plot, title.cex = 2, title = "Pre To 6mFU", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','PreTo6mFU'))


```


# Plot Pre data

No condition variable in this network so it needs to be plotted using different syntax than the rest...

```{r}

# use PreToPost layout but get rid of placement of the condition node
PreLayout <- PreToPost.layout[2:8,1:2]

# plot
my_edgeweights <- Pre.fit$pairwise$wadj
  
  my_colorblind_edge_colors <- Pre.fit$pairwise$edgecolor_cb
  
  qgraph(my_edgeweights, 
         layout = 'spring', repulsion = 1.3,
         edge.color = my_colorblind_edge_colors, 
         layout = PreLayout,
         legend.cex=.4, 
         title.cex = 2,
         title = 'Pre',
         node.width = 2,
         vsize = 3.5, esize = 15, labels = c('HADS','IESR','FCR','SCS','EAC','AAQc','CESD'), filetype = 'png',
        filename = here('5 Tables and Figures','Pre'))
    
```
# Plot the rest of the single timepoint models

## generic function - plot MGM
```{r}

plot_my_mgm <- function(my_mgm_fit){
  
  my_edgeweights <- my_mgm_fit$pairwise$wadj
  
  my_colorblind_edge_colors <- my_mgm_fit$pairwise$edgecolor_cb
  
  qgraph(my_edgeweights, 
         layout = 'spring', repulsion = 1.3,
         edge.color = my_colorblind_edge_colors, 
         legend.cex=.4, 
         vsize = 3.5, esize = 15, labels = c('*COND*','HADS','IESR','FCR','SCS','EAC','AAQc','CESD'))
}
  
```

## run and save plots

```{r}

Mid.plot <- plot_my_mgm(Mid.fit)
Post.plot <- plot_my_mgm(Post.fit)
my3mFU.plot <- plot_my_mgm(my3mFU.fit)
my6mFU.plot <- plot_my_mgm(my6mFU.fit)


```



# Output plots for each interval

```{r}
qgraph::qgraph(Mid.plot, title.cex = 2, title = "Mid", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','Mid'))

qgraph::qgraph(Post.plot, title.cex = 2, title = "Post", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','Post'))

qgraph::qgraph(my3mFU.plot, title.cex = 2, title = "3m FU", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','3m FU'))

qgraph::qgraph(my6mFU.plot, title.cex = 2, title = "6m FU", 
               node.width = 2,
               layout = PreToPost.layout,
               filetype = 'png', filename = here('5 Tables and Figures','6m FU'))
```

